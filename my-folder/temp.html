<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Sensor Data Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body {
        font-family: "Segoe UI", Arial, sans-serif;
        margin: 40px;
        background: #f4f7fa;
      }
      h1 {
        text-align: center;
        color: #333;
      }
      #chartContainer {
        max-width: 900px;
        margin: 30px auto;
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      }
      canvas {
        width: 100%;
        height: 400px;
      }
      footer {
        text-align: center;
        margin-top: 30px;
        color: #777;
      }
    </style>
  </head>
  <body>
    <h1>Sensor Data Dashboard</h1>
    <div id="chartContainer">
      <canvas id="sensorChart"></canvas>
    </div>
    <footer>Data Source: Google Sheets (auto-updating)</footer>

    <script>
      // ðŸ§© Replace this link with your published CSV link
      const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT1hZpKjv4iJ3wfOMr8UNFtnEart5xDtzbh5lKg9eKBgbMy_kZxucwYL8WpgqfRPXrG2M_igBezxwfM/pub?output=csv";

      async function fetchData() {
        const response = await fetch(csvUrl);
        const data = await response.text();
        const rows = data.trim().split("\n").map(r => r.split(","));
        
        const labels = [];
        const values = [];
        const dates = [];

        for (let i = 1; i < rows.length; i++) {
          const date = rows[i][0];
          const value = parseFloat(rows[i][1]);
          if (!isNaN(value)) {
            labels.push("Reading " + i);
            values.push(value);
            dates.push(date);
          }
        }

        return { labels, values, dates };
      }

      async function createChart() {
        const { labels, values, dates } = await fetchData();
        const ctx = document.getElementById("sensorChart").getContext("2d");

        if (window.sensorChart instanceof Chart) {
          window.sensorChart.destroy();
        }

        window.sensorChart = new Chart(ctx, {
          type: "line",
          data: {
            labels: labels,
            datasets: [{
              label: "Sensor Value",
              data: values,
              borderColor: "#007bff",
              backgroundColor: "rgba(0, 123, 255, 0.1)",
              fill: true,
              tension: 0.3,
              pointRadius: 3,
            }]
          },
          options: {
            responsive: true,
            scales: {
              x: { title: { display: true, text: "Reading Number" } },
              y: { title: { display: true, text: "Sensor Value" } }
            },
            plugins: {
              title: { display: true, text: "Sensor Data Over Time" },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return "Value: " + context.parsed.y + " (" + dates[context.dataIndex] + ")";
                  }
                }
              }
            }
          }
        });
      }

      // ðŸ•’ Auto-refresh every 30 seconds
      createChart();
      setInterval(createChart, 30000);
    </script>
  </body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sensor Data Dashboard</title>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script>
    google.charts.load('current', { packages: ['corechart'] });
    google.charts.setOnLoadCallback(loadData);

    async function loadData() {
      const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT1hZpKjv4iJ3wfOMr8UNFtnEart5xDtzbh5lKg9eKBgbMy_kZxucwYL8WpgqfRPXrG2M_igBezxwfM/pub?output=csv";
      document.getElementById("status").textContent = "Loading data...";

      try {
        const response = await fetch(csvUrl);
        if (!response.ok) throw new Error("Network response was not ok");
        const csv = await response.text();
        const data = parseCSV(csv);
        drawChart(data);
      } catch (error) {
        console.error("Error loading data:", error);
        document.getElementById("status").textContent =
          "❌ Error loading data. Check your Sheet link or sharing settings.";
      }
    }

    function parseCSV(csvText) {
      const rows = csvText.trim().split("\n").map(r => r.split(","));
      rows.shift(); // remove header
      const dataArray = [["Reading", "Sensor Value"]];

      rows.forEach((row, i) => {
        const readingLabel = `Reading ${i + 1}`;
        const value = parseFloat(row[1]);
        if (!isNaN(value)) dataArray.push([readingLabel, value]);
      });

      return google.visualization.arrayToDataTable(dataArray);
    }

    function drawChart(data) {
      const options = {
        title: "Sensor Data",
        hAxis: { title: "Reading Number" },
        vAxis: { title: "Sensor Value" },
        legend: "none",
        curveType: "function",
        pointSize: 4,
        colors: ["#1E88E5"],
        backgroundColor: "#f8f9fa"
      };

      const chart = new google.visualization.LineChart(
        document.getElementById("chart_div")
      );
      chart.draw(data, options);
      document.getElementById("status").textContent = "✅ Chart loaded successfully.";
    }
  </script>
</head>
<body style="font-family: Arial, sans-serif; background-color: #fff; padding: 20px;">
  <h2>Sensor Data Dashboard</h2>
  <p id="status">Loading data...</p>
  <div id="chart_div" style="width: 100%; height: 500px;"></div>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sensor, Temperature, and Humidity Data</title>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script>
    google.charts.load('current', { packages: ['corechart'] });
    google.charts.setOnLoadCallback(loadData);

    async function loadData() {
      const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT1hZpKjv4iJ3wfOMr8UNFtnEart5xDtzbh5lKg9eKBgbMy_kZxucwYL8WpgqfRPXrG2M_igBezxwfM/pub?output=csv';
      
      try {
        const response = await fetch(sheetUrl);
        if (!response.ok) throw new Error('Network response was not ok');
        const csv = await response.text();
        const data = parseCSV(csv);
        drawChart(data);
      } catch (error) {
        document.getElementById('status').textContent = '❌ Error loading data. Check your Sheet link or sharing settings.';
        console.error('Error:', error);
      }
    }

    function parseCSV(csvText) {
      const rows = csvText.trim().split('\n').map(r => r.split(','));
      rows.shift(); // remove header row

      const dataArray = [['Reading', 'Sensor 1', 'Temperature', 'Humidity']];
      rows.forEach((row, i) => {
        const sensor = parseFloat(row[1]);
        const temp = parseFloat(row[2]);
        const hum = parseFloat(row[3]);
        if (!isNaN(sensor) && !isNaN(temp) && !isNaN(hum)) {
          dataArray.push([i + 1, sensor, temp, hum]);
        }
      });

      return google.visualization.arrayToDataTable(dataArray);
    }

    function drawChart(data) {
      const options = {
        title: 'Sensor, Temperature, and Humidity Readings',
        hAxis: { title: 'Reading Number' },
        vAxis: { title: 'Value' },
        curveType: 'function',
        legend: { position: 'bottom' },
        pointSize: 4,
        colors: ['#1E88E5', '#E53935', '#43A047'],
        backgroundColor: '#f8f9fa'
      };

      const chart = new google.visualization.LineChart(document.getElementById('chart_div'));
      chart.draw(data, options);
      document.getElementById('status').textContent = '✅ Chart loaded successfully.';
    }
  </script>
</head>
<body style="font-family: Arial, sans-serif; background-color: #fff; padding: 20px;">
  <h2>Sensor Data Dashboard</h2>
  <p id="status">Loading data...</p>
  <div id="chart_div" style="width: 100%; height: 500px;"></div>
</body>
</html>

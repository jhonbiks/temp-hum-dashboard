<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Sensor Data Chart</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script>
      google.charts.load('current', { packages: ['corechart'] });
      google.charts.setOnLoadCallback(loadData);

      async function loadData() {
        const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTq0y8-I6AvCUyPBppc4SZ3htd7OBWlSAM-S7DGP29vhaDqeyxhND5tVRPAOkG_XVZHawuCQPsbI77F/pub?output=csv';
        
        try {
          const response = await fetch(sheetUrl);
          if (!response.ok) throw new Error('Network response was not ok');
          const csv = await response.text();
          const data = parseCSV(csv);
          drawChart(data);
        } catch (error) {
          document.getElementById('status').textContent = '❌ Error loading data. Check your Sheet link or sharing settings.';
          console.error('Error:', error);
        }
      }

      function parseCSV(csvText) {
        const rows = csvText.trim().split('\n').map(r => r.split(','));
        rows.shift(); // Remove header row (Date, Sensor Value)
        const dataArray = [['Date', 'Sensor Value']];
        
        rows.forEach(row => {
          const date = new Date(row[0]);
          const value = parseFloat(row[1]);
          if (!isNaN(date.getTime()) && !isNaN(value)) {
            dataArray.push([date, value]);
          }
        });

        return google.visualization.arrayToDataTable(dataArray);
      }

      function drawChart(data) {
        const options = {
          title: 'Sensor Data',
          hAxis: { title: 'Date/Time' },
          vAxis: { title: 'Sensor Value' },
          legend: 'none',
          curveType: 'function',
          pointSize: 4,
          colors: ['#1E88E5'],
          backgroundColor: '#f8f9fa'
        };

        const chart = new google.visualization.LineChart(document.getElementById('chart_div'));
        chart.draw(data, options);
        document.getElementById('status').textContent = '✅ Chart loaded successfully.';
      }
    </script>
  </head>
  <body style="font-family: Arial, sans-serif; background-color: #fff; padding: 20px;">
    <h2>Sensor Data Dashboard</h2>
    <p id="status">Loading data...</p>
    <div id="chart_div" style="width: 100%; height: 500px;"></div>
  </body>
</html>

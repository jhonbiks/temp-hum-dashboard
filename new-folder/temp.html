<!DOCTYPE html>
<html>
  <head>
    <title>Sensor Data Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body style="font-family: Arial; margin: 40px;">
    <h2>Sensor Data</h2>
    <canvas id="sensorChart" width="800" height="400"></canvas>

    <script>
      // Google Sheets CSV link
      const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTq0y8-I6AvCUyPBppc4SZ3htd7OBWlSAM-S7DGP29vhaDqeyxhND5tVRPAOkG_XVZHawuCQPsbI77F/pub?output=csv";

      // Fetch and parse CSV data
      async function fetchData() {
        const response = await fetch(csvUrl);
        const data = await response.text();
        const rows = data.trim().split("\n").map(r => r.split(","));
        
        const labels = []; // reading numbers
        const values = [];
        const dates = [];

        for (let i = 1; i < rows.length; i++) { // skip header
          const date = rows[i][0];
          const value = parseFloat(rows[i][1]);
          if (!isNaN(value)) {
            labels.push("Reading " + i);
            values.push(value);
            dates.push(date);
          }
        }

        return { labels, values, dates };
      }

      async function createChart() {
        const { labels, values, dates } = await fetchData();

        const ctx = document.getElementById("sensorChart").getContext("2d");
        new Chart(ctx, {
          type: "line",
          data: {
            labels: labels,
            datasets: [{
              label: "Sensor Value",
              data: values,
              borderColor: "blue",
              backgroundColor: "rgba(0, 123, 255, 0.2)",
              fill: true,
              tension: 0.3,
              pointRadius: 3,
            }]
          },
          options: {
            responsive: true,
            scales: {
              x: {
                title: { display: true, text: "Reading Number" }
              },
              y: {
                title: { display: true, text: "Sensor Value" },
                beginAtZero: false
              }
            },
            plugins: {
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return "Value: " + context.parsed.y + " (" + dates[context.dataIndex] + ")";
                  }
                }
              },
              title: {
                display: true,
                text: "Sensor Data Over Readings"
              }
            }
          }
        });
      }

      createChart();
    </script>
  </body>
</html>
